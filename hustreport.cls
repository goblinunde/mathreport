% =========================================================
% HUST Report Template Class
% æ–‡ä»¶å: hustreport.cls
% è¯´æ˜: é»‘é¾™æ±Ÿç§‘æŠ€å¤§å­¦ç¤¾ä¼šè°ƒæŸ¥æŠ¥å‘Š/å®ä¹ æŠ¥å‘Šä¸“ç”¨æ¨¡æ¿ç±»
% ç‰ˆæœ¬: v2.13 (Modular Refactor)
% æ—¥æœŸ: 2025/02/20
% =========================================================

% ---------------------------------------------------------
% 0. ç‰ˆæœ¬ä¸æ ¼å¼å£°æ˜
% ---------------------------------------------------------
\NeedsTeXFormat{LaTeX2e}
\ProvidesClass{hustreport}[2026/01/05 v3.0 HUST Report Class]


% ---------------------------------------------------------
% 1. æ ¸å¿ƒé€‰é¡¹ä¸åŸºç±»åŠ è½½
% ---------------------------------------------------------
% [æ–°å¢] å®šä¹‰ç³»ç»Ÿå¹³å°ä¸å­—ä½“æ¨¡å¼å¼€å…³
\newif\ifhust@oswin    \hust@oswinfalse
\newif\ifhust@osmac    \hust@osmacfalse
\newif\ifhust@oslinux  \hust@oslinuxfalse
\newif\ifhust@optfonts \hust@optfontsfalse % æ–°å¢ fonts æ˜¾å¼å¼€å…³
\newif\ifhust@thesis   \hust@thesisfalse   % ğŸ’¡ æ¯•ä¸šè®ºæ–‡æ¨¡å¼å¼€å…³

% [æ–°å¢] å£°æ˜å‚æ•°é€‰é¡¹
\DeclareOption{win}{\hust@oswintrue}
\DeclareOption{mac}{\hust@osmactrue}
\DeclareOption{linux}{\hust@oslinuxtrue}
\DeclareOption{fonts}{\hust@optfontstrue} % å¼€å¯æœ¬åœ°å­—ä½“ä¼˜å…ˆæ¨¡å¼
\DeclareOption{thesis}{\hust@thesistrue}  % ğŸ’¡ å¯ç”¨æ¯•ä¸šè®ºæ–‡é¡µçœ‰æ¨¡å¼

% ä¼ é€’æ‰€æœ‰æœªå®šä¹‰çš„é€‰é¡¹ç»™åº•å±‚ç±»
\DeclareOption*{\PassOptionsToClass{\CurrentOption}{ctexrep}}
\ProcessOptions\relax

% åŠ è½½ ctexrep åŸºç±»
% [å‚æ•°è¯´æ˜]
% a4paper: A4çº¸å¼ 
% UTF8: ç¼–ç æ ¼å¼
% zihao=-4: æ­£æ–‡é»˜è®¤å°å››å·å­—
% linespread=1.5: é»˜è®¤ 1.5 å€è¡Œè·
\LoadClass[a4paper,UTF8,zihao=-4,linespread=1.5]{ctexrep}



% ---------------------------------------------------------
% 2. å®åŒ…åŠ è½½ (æŒ‰åŠŸèƒ½åˆ†ç±»)
% ---------------------------------------------------------

% [2.1] é¡µé¢ä¸å¸ƒå±€
\RequirePackage{geometry}   % é¡µé¢è¾¹è·è®¾ç½®
\RequirePackage{fancyhdr}   % é¡µçœ‰é¡µè„šå®šåˆ¶
\RequirePackage{float}      % æµ®åŠ¨ä½“æ§åˆ¶ (Hå‚æ•°)
\RequirePackage[sort&compress,numbers,square]{natbib} % å‚è€ƒæ–‡çŒ®ç®¡ç†

% [2.2] æ ‡é¢˜ä¸ç›®å½•
\RequirePackage{titletoc}   % ç›®å½•æ ¼å¼å®šåˆ¶
\RequirePackage{titlesec}   % ç« èŠ‚æ ‡é¢˜æ ¼å¼å®šåˆ¶

% [2.3] æ•°å­¦ä¸ç‰©ç†
\RequirePackage{amsmath,amssymb,amsfonts,amsthm} % æ•°å­¦å…¬å¼æ ¸å¿ƒåŒ…
\RequirePackage{physics}    % ç‰©ç†ç¬¦å·ä¾¿æ·åŒ…
\RequirePackage{siunitx}    % å›½é™…å•ä½åˆ¶æ”¯æŒ
\RequirePackage{newtxmath}  % æ•°å­¦å­—ä½“ä¼˜åŒ–
\RequirePackage{calc}       % é•¿åº¦è®¡ç®—æ”¯æŒ

% [2.4] å›¾å½¢ä¸é¢œè‰²
\RequirePackage{graphicx}   % å›¾ç‰‡æ’å…¥
\RequirePackage{subcaption} % å­å›¾æ”¯æŒ
\RequirePackage{tikz}       % ç»˜å›¾ä¸ç»å¯¹å®šä½(ç”¨äºå°é¢Logo)
\RequirePackage[dvipsnames, svgnames, x11names]{xcolor} % é¢œè‰²æ”¯æŒ

% [2.5] è¡¨æ ¼ä¸åˆ—è¡¨
\RequirePackage{booktabs}   % ä¸‰çº¿è¡¨æ”¯æŒ
\RequirePackage{threeparttable} 
\RequirePackage{caption} 
\RequirePackage{tabularx}   % è‡ªé€‚åº”å®½åº¦è¡¨æ ¼
\RequirePackage{xltabular} % <--- å¿…é¡»æ·»åŠ è¿™ä¸ªå®åŒ…ï¼Œç”¨äºæ”¯æŒè·¨é¡µé•¿è¡¨æ ¼
\RequirePackage{multirow}   % è¡¨æ ¼å¤šè¡Œåˆå¹¶
\RequirePackage{makecell}   % è¡¨æ ¼å•å…ƒæ ¼æ¢è¡Œ
\RequirePackage{array}      % è¡¨æ ¼åˆ—æ ¼å¼æ‰©å±•
\RequirePackage{enumitem}   % åˆ—è¡¨ç¯å¢ƒå®šåˆ¶
\RequirePackage{diagbox}
% [2.6] å­—ä½“ä¸ä¿®é¥°
\RequirePackage{anyfontsize} % ä»»æ„å­—å·æ”¯æŒ % ä¸‹åˆ’çº¿æ”¯æŒ (normalemé˜²æ­¢emè¢«é‡å®šä¹‰ä¸ºä¸‹åˆ’çº¿)

% [2.7] è¶…é“¾æ¥ä¸PDFå±æ€§
\RequirePackage{hyperref}   % è¶…é“¾æ¥æ”¯æŒ

% ---------------------------------------------------------
% 3. ä¿¡æ¯æ¥å£å®šä¹‰ (ç”¨æˆ·å¡«å†™çš„å˜é‡)
% ---------------------------------------------------------
\makeatletter % å¼€å¯å†…éƒ¨å‘½ä»¤æ¨¡å¼

% [3.1] å†…éƒ¨å­˜å‚¨å˜é‡å®šä¹‰
\newcommand{\@major}{}      % ä¸“ä¸š
\newcommand{\@dept}{}       % é™¢ç³»
\newcommand{\@advisor}{}    % æŒ‡å¯¼æ•™å¸ˆ
\newcommand{\@team}{}       % é˜Ÿå‘˜
\newcommand{\@studentID}{}  % å­¦å·
\newcommand{\@reportID}{}   % æŠ¥å‘Šç¼–å·

% [3.2] å¯¹å¤–æ¥å£å‘½ä»¤
\newcommand{\major}[1]{\def\@major{#1}}
\newcommand{\dept}[1]{\def\@dept{#1}}
\newcommand{\advisor}[1]{\def\@advisor{#1}}
\newcommand{\team}[1]{\def\@team{#1}}
\newcommand{\studentID}[1]{\def\@studentID{#1}}
\newcommand{\reportID}[1]{\def\@reportID{#1}}

% [3.3] ä»»åŠ¡ä¹¦ä¸“ç”¨å˜é‡
\newcommand{\taskTargetText}{å†…å®¹å¾…å®š}
\newcommand{\taskContentText}{å†…å®¹å¾…å®š}
\newcommand{\taskExpectedText}{å†…å®¹å¾…å®š}
\newcommand{\taskScheduleText}{è¿›åº¦å¾…å®š}

% [3.4] è‡ªé€‚åº”ä¸‹åˆ’çº¿ç»„ä»¶ (ç”¨äºå¡«ç©ºå¤„)
\newcommand{\ulineinfo}[2][280pt]{%
	\begin{minipage}[t]{#1}%
		\centering\zihao{3}\songti\uline{#2\hfill}%
	\end{minipage}%
}

% ---------------------------------------------------------
% 4. å­—ä½“é…ç½® (æ™ºèƒ½æ£€æµ‹ + å¤šå¹³å°é€‚é… + ä¼ªç²—ä½“ä¼˜åŒ–)
% ---------------------------------------------------------
% æ¸…é™¤æ—§å®šä¹‰
\let\songti\relax
\let\heiti\relax
\let\kaiti\relax

% ---------------------------------------------------------
% é€»è¾‘ä¼˜å…ˆçº§è¯´æ˜ï¼š
% 1. [æœ€é«˜ä¼˜å…ˆçº§] æœ¬åœ° fonts/ ç›®å½•å­˜åœ¨ï¼š
%    æ— è®ºå‚æ•°å¦‚ä½•ï¼Œåªè¦æœ‰æ–‡ä»¶ï¼Œå¼ºåˆ¶ä½¿ç”¨æœ¬åœ°æ–‡ä»¶ä»¥ä¿è¯ä¸€è‡´æ€§ã€‚
%    å¦‚æœç”¨æˆ·æ˜¾å¼æŒ‡å®šäº† [fonts] ä½†æ²¡æ–‡ä»¶ï¼Œä¼šå‘å‡ºè­¦å‘Šã€‚
% 2. [å‚æ•°ä¼˜å…ˆ] win -> Windows ç³»ç»Ÿå­—ä½“ (è‡ªåŠ¨å¼€å¯ä¼ªç²—ä½“)
% 3. [å‚æ•°ä¼˜å…ˆ] mac -> macOS ç³»ç»Ÿå­—ä½“
% 4. [ä¿åº•ç­–ç•¥] linux æˆ– é»˜è®¤ -> Fandol å¼€æºå­—ä½“
% ---------------------------------------------------------

% æ£€æŸ¥æœ¬åœ°å­—ä½“æ–‡ä»¶çš„æ ¸å¿ƒæ ‡è¯†
% é€»è¾‘æ›´æ–°ï¼šåˆ†åˆ«æ£€æµ‹ä¸­è‹±æ–‡å­—ä½“ï¼Œå®ç°æ··åˆåŠ è½½æ¨¡å¼

% --- 4.1 è‹±æ–‡å­—ä½“é…ç½® ---
\IfFileExists{fonts/times.ttf}{
    % [æœ¬åœ°] å‘ç°æœ¬åœ° Times å­—ä½“ (æ–‡ä»¶ååŒ¹é…å®é™…åˆ—è¡¨: times.ttf, timesbd.ttf...)
    \typeout{>> [HUST Report] Local English fonts found (fonts/times.ttf).}
    \setmainfont{times.ttf}[
        Path = fonts/,
        BoldFont = timesbd.ttf,
        ItalicFont = timesi.ttf,
        BoldItalicFont = timesbi.ttf
    ]
}{
    % [ç³»ç»Ÿ] æœªå‘ç°æœ¬åœ°å­—ä½“ï¼Œä½¿ç”¨ç³»ç»Ÿå›é€€
    \ifhust@oswin
        \setmainfont{Times New Roman}
    \else
        \ifhust@osmac
            \setmainfont{Times New Roman}
        \else
            \setmainfont{TeX Gyre Termes}
        \fi
    \fi
}

% --- 4.2 ä¸­æ–‡å­—ä½“é…ç½® ---
% ä¼˜å…ˆæ£€æµ‹ fonts/SimSun.ttf
\IfFileExists{fonts/SimSun.ttf}{
    % [æœ¬åœ°] å‘ç°æœ¬åœ°å®‹ä½“
    \typeout{>> [HUST Report] Local Chinese fonts found (fonts/SimSun.ttf).}
    \defaultfontfeatures{Ligatures=TeX}
    
    % é¢„åˆ¤å­—ä½“æ–‡ä»¶æ˜¯å¦å­˜åœ¨ï¼Œç¡®å®šå­—ä½“å‚æ•°
    \IfFileExists{fonts/SimHei.ttf}{%
        \def\hust@cjk@bold{SimHei.ttf}%
        \def\hust@cjk@fakebold{false}%
    }{%
        \def\hust@cjk@bold{SimSun.ttf}%
        \def\hust@cjk@fakebold{2.5}%
    }%
    
    \IfFileExists{fonts/KaiTi.ttf}{%
        \def\hust@cjk@italic{KaiTi.ttf}%
    }{%
        \def\hust@cjk@italic{SimSun.ttf}%
    }%
    
    % ä¸»å­—ä½“è®¾ç½®
    \setCJKmainfont{SimSun.ttf}[
        Path = fonts/,
        BoldFont = \hust@cjk@bold,
        ItalicFont = \hust@cjk@italic,
        AutoFakeBold = \hust@cjk@fakebold
    ]
    
    % é…å¥—å­—ä½“è®¾ç½®
    \IfFileExists{fonts/SimHei.ttf}{
        \setCJKsansfont{SimHei.ttf}[Path = fonts/]
        \newCJKfontfamily\heiti{SimHei.ttf}[Path=fonts/]
    }{
        \setCJKsansfont{SimSun.ttf}[Path = fonts/, AutoFakeBold=2.5]
        \newCJKfontfamily\heiti{SimSun.ttf}[Path=fonts/, AutoFakeBold=2.5]
    }
    
    \IfFileExists{fonts/KaiTi.ttf}{
        \setCJKmonofont{KaiTi.ttf}[Path = fonts/]
        \newCJKfontfamily\kaiti{KaiTi.ttf}[Path=fonts/]
    }{
        \setCJKmonofont{SimSun.ttf}[Path = fonts/, AutoFakeBold=2.5]
        \newCJKfontfamily\kaiti{SimSun.ttf}[Path=fonts/, AutoFakeBold=2.5]
    }
    
    \newCJKfontfamily\songti{SimSun.ttf}[Path=fonts/, AutoFakeBold=2.5]

}{
    % [ç³»ç»Ÿ] æœªå‘ç°æœ¬åœ°å®‹ä½“ï¼Œæ‰§è¡Œç³»ç»Ÿå›é€€é€»è¾‘
    \ifhust@oswin
        % Windows
        \typeout{>> [HUST Report] Using Windows system fonts.}
        \setCJKmainfont[BoldFont=SimHei,ItalicFont=KaiTi,AutoFakeBold=2.5]{SimSun}
        \setCJKsansfont[AutoFakeBold=2.5]{SimHei}
        \setCJKmonofont[AutoFakeBold=2.5]{KaiTi}
        \newCJKfontfamily\songti{SimSun}[BoldFont=SimHei,ItalicFont=KaiTi,AutoFakeBold=2.5]
        \newCJKfontfamily\heiti{SimHei}[AutoFakeBold=2.5]
        \newCJKfontfamily\kaiti{KaiTi}[AutoFakeBold=2.5]
    \else
    \ifhust@osmac
        % macOS
        \typeout{>> [HUST Report] Using macOS system fonts.}
        \setCJKmainfont[BoldFont=Heiti SC Medium,ItalicFont=Kaiti SC,AutoFakeBold=2.0]{Songti SC Light}
        \setCJKsansfont[AutoFakeBold=2.0]{Heiti SC Medium}
        \setCJKmonofont[AutoFakeBold=2.0]{Kaiti SC}
        \newCJKfontfamily\songti{Songti SC Light}[BoldFont=Heiti SC Medium,ItalicFont=Kaiti SC, AutoFakeBold=2.0]
        \newCJKfontfamily\heiti{Heiti SC Medium}
        \newCJKfontfamily\kaiti{Kaiti SC}
    \else
        % Linux / Default (Fandol)
        \typeout{>> [HUST Report] Using Fandol fonts (Linux/Fallback).}
        \setCJKmainfont[
            Extension=.otf,
            BoldFont=FandolHei-Regular,
            ItalicFont=FandolKai-Regular
        ]{FandolSong-Regular}
        \setCJKsansfont[Extension=.otf]{FandolHei-Regular}
        \setCJKmonofont[Extension=.otf]{FandolKai-Regular}
        \newCJKfontfamily\songti[Extension=.otf]{FandolSong-Regular}
        \newCJKfontfamily\heiti[Extension=.otf]{FandolHei-Regular}
        \newCJKfontfamily\kaiti[Extension=.otf]{FandolKai-Regular}
    \fi
    \fi
}

% ---------------------------------------------------------
% 5. é¡µé¢å¸ƒå±€ä¸è®¡æ•°å™¨è®¾ç½®
% ---------------------------------------------------------
% [5.1] é¡µé¢è¾¹è·ä¸é¡µçœ‰é…ç½® (æŒ‰æ¨¡å¼åˆ‡æ¢)
\ifhust@thesis
    % ğŸ’¡ æ¯•ä¸šè®ºæ–‡æ¨¡å¼ï¼šä½¿ç”¨ç‰¹æ®Šé¡µçœ‰å’Œæ›´å¤§çš„ top margin
    \geometry{
        a4paper,
        top=3.7cm,
        bottom=2.5cm,
        left=3.9cm,
        right=2.5cm,
        headheight=3cm,
        headsep=0.5cm
    }
    
    % é…ç½® fancyhdr é¡µçœ‰
    \pagestyle{fancy}
    \fancyhf{} % æ¸…é™¤é»˜è®¤é¡µçœ‰é¡µè„š
    
    % é¡µçœ‰åˆ†éš”çº¿å®½åº¦
    \renewcommand{\headrulewidth}{2.5pt}
    
    % å·¦ä¾§ï¼šæ ¡å¾½ Logo
    \fancyhead[L]{%
        \raisebox{-0.2cm}{\includegraphics[height=2.6cm]{logo.png}}%
    }
    
    % ä¸­é—´ï¼šæ ¡åå›¾ç‰‡ + "æ¯•ä¸šè®ºæ–‡"å­—æ ·
    \fancyhead[C]{%
        \raisebox{0.5cm}{%
            \begin{tabular}{c}
                \includegraphics[height=1.2cm]{ustc.png} \\[-2pt]
                {\zihao{2}\heiti æ¯•\hspace{2.05em}ä¸š\hspace{2.05em}è®º\hspace{2.05em}æ–‡}
            \end{tabular}%
        }%
    }
    
    % é¡µè„šï¼šé¡µç å±…ä¸­
    \fancyfoot[C]{\thepage}
    
\else
    % ğŸ’¡ æ™®é€šæŠ¥å‘Šæ¨¡å¼ï¼šä½¿ç”¨ç®€æ´çš„é¡µé¢è®¾ç½®
    \geometry{left=3.017cm, right=3.017cm, top=2.54cm, bottom=2.54cm, headheight=15pt}
    \pagestyle{plain} % é¡µç ä½äºåº•éƒ¨å±…ä¸­
\fi

% [5.2] è®¡æ•°å™¨é€»è¾‘ä¸å±‚çº§ç»‘å®š
% ä¿æŒåº•å±‚è®¡æ•°å™¨ä¸ºé˜¿æ‹‰ä¼¯æ•°å­—
\renewcommand{\thesection}{\arabic{section}}
\renewcommand{\thesubsection}{\thesection.\arabic{subsection}}
\renewcommand{\thesubsubsection}{\thesubsection.\arabic{subsubsection}}

% [é‡è¦] å»ºç«‹ç¼–å·ç»‘å®šå…³ç³»ï¼šå®ç° (ç« -åºå·) ä¸”æ¯ç« è‡ªåŠ¨é‡ç½®ä¸º 1
% å¿…é¡»åœ¨å¯¼è¨€åŒºä½¿ç”¨ \counterwithin (éœ€è¦ LaTeX 2018+ æˆ– chngcntr å®åŒ…)
\counterwithin{equation}{section}
\counterwithin{figure}{section}
\counterwithin{table}{section}

% [5.3] ç›®å½•æ·±åº¦è®¾ç½® (æ˜¾ç¤ºåˆ°ä¸‰çº§æ ‡é¢˜)
\setcounter{secnumdepth}{3}
\setcounter{tocdepth}{3}


% ---------------------------------------------------------
% 6. ç« èŠ‚æ ‡é¢˜ä¸ç›®å½•æ ·å¼
% ---------------------------------------------------------

% [6.1] ç« èŠ‚æ ‡é¢˜æ ·å¼ (ctexset)
\ctexset{
	% ä¸€çº§æ ‡é¢˜ (Section/ç« ) -> "ç¬¬ä¸€ç« "
	section = {
		number = \chinese{section}, % å¼ºåˆ¶è½¬ä¸­æ–‡æ•°å­—
		name = {ç¬¬,ç« },             % å‰åç¼€
		format = \centering\zihao{3}\heiti\bfseries, % ä¸‰å·é»‘ä½“åŠ ç²—å±…ä¸­
		aftername = \quad,
		beforeskip = 15pt,
		afterskip = 20pt,
		fixskip = true
	},
	% äºŒçº§æ ‡é¢˜ (Subsection/èŠ‚) -> "1.1"
	subsection = {
		name = {},
		number = \thesubsection,
		format = \zihao{4}\heiti\bfseries, % å››å·é»‘ä½“åŠ ç²—
		aftername = \hspace{1em},
		afterskip = 1ex
	},
	% ä¸‰çº§æ ‡é¢˜ (Subsubsection/å°èŠ‚) -> "1.1.1"
	subsubsection = {
		name = {},
		number = \thesubsubsection,
		format = \zihao{-4}\songti, % å°å››å·å®‹ä½“
		aftername = \hspace{1em},
		afterskip = 1ex
	}
}

% [6.2] ç›®å½•æ ·å¼ (titletoc)
% ---------------------------------------------------------

% ç«  (Section)
\titlecontents{section}[0pt]
{\addvspace{6pt}\bfseries\heiti\zihao{4}} % æ ¼å¼
{\thecontentslabel\quad}                  % æ ‡ç­¾
{}                                        % æ— æ ‡ç­¾æ—¶çš„æ ¼å¼
{\titlerule*[0.5pc]{.}\contentspage}      % å¼•å¯¼çº¿å’Œé¡µç 

% èŠ‚ (Subsection)
\titlecontents{subsection}[2em]
{\songti\zihao{-4}}
{\thecontentslabel\quad}
{}
{\titlerule*[0.5pc]{.}\contentspage}

% å°èŠ‚ (Subsubsection)
\titlecontents{subsubsection}[4em]
{\songti\zihao{-4}}
{\thecontentslabel\quad}
{}
{\titlerule*[0.5pc]{.}\contentspage}


% ---------------------------------------------------------
% 7. å›¾è¡¨ã€å…¬å¼ä¸å¼•ç”¨æ ·å¼ (é«˜çº§é…ç½®)
% ---------------------------------------------------------
\setkeys{Gin}{draft=false} % å¼ºåˆ¶æ˜¾ç¤ºå›¾ç‰‡

% [7.1] æµ®åŠ¨ä½“å‚æ•°ä¼˜åŒ– (è§£å†³å›¾ç‰‡ä¹±è·‘é—®é¢˜)
% å…è®¸é¡¶éƒ¨æµ®åŠ¨ä½“å æ®é¡µé¢çš„ 85% (é»˜è®¤ 70%)
\renewcommand{\topfraction}{0.85}
% å…è®¸åº•éƒ¨æµ®åŠ¨ä½“å æ®é¡µé¢çš„ 70% (é»˜è®¤ 30%)
\renewcommand{\bottomfraction}{0.70}
% æ–‡æœ¬é¡µä¸­ï¼Œæ–‡æœ¬è‡³å°‘è¦å  10% (é»˜è®¤ 20%)ï¼Œæ„å‘³ç€å›¾ç‰‡å¯ä»¥å  90%
\renewcommand{\textfraction}{0.10}
% æµ®åŠ¨é¡µä¸­ï¼Œå›¾ç‰‡è‡³å°‘è¦å  50% æ‰èƒ½ç‹¬ç«‹æˆé¡µ
\renewcommand{\floatpagefraction}{0.50}

% [7.2] Caption æ ·å¼ (æ•´åˆé•¿è¡¨æ ¼æ”¯æŒ)
\DeclareCaptionFont{heiti}{\heiti}
\DeclareCaptionFont{fivehao}{\zihao{5}}
\captionsetup{
	format=hang,        % æ‚¬æŒ‚ç¼©è¿›
	labelsep=quad,      % æ ‡ç­¾ä¸å†…å®¹é—´çš„ç©ºæ ¼
	font={fivehao,heiti},      % å­—ä½“è®¾ç½®
	labelfont={fivehao,heiti}, % æ ‡ç­¾å­—ä½“
	textfont={fivehao,heiti},  % å†…å®¹å­—ä½“
	skip=6pt            % æ ‡é¢˜ä¸å›¾è¡¨çš„é—´è·
}
\captionsetup[sub]{labelformat=simple}

% é’ˆå¯¹é•¿è¡¨æ ¼ (longtable/xltabular) çš„ç‰¹æ®Šè®¾ç½®
% ç¡®ä¿è·¨é¡µè¡¨æ ¼çš„æ ‡é¢˜å®½åº¦ä¸é¡µé¢ä¸€è‡´
\AtBeginEnvironment{longtable}{\setlength{\LTcapwidth}{\textwidth}}
\AtBeginEnvironment{xltabular}{\setlength{\LTcapwidth}{\textwidth}}

% [7.3] ç¼–å·æ ¼å¼å®šä¹‰ (ç« -åºå·)
% æ³¨æ„ï¼š\counterwithin å·²ç»å¤„ç†äº†è®¡æ•°å™¨é‡ç½®é€»è¾‘
% è¿™é‡Œåªéœ€è¦å®šä¹‰æ˜¾ç¤ºçš„æ ¼å¼å³å¯
\renewcommand\thesubfigure{(\alph{subfigure})}
\renewcommand{\theequation}{\thesection-\arabic{equation}}
\renewcommand{\thefigure}{\thesection-\arabic{figure}}
\renewcommand{\thetable}{\thesection-\arabic{table}}

% [7.4] å¼•ç”¨æ ¼å¼å® (è‡ªåŠ¨æ·»åŠ å‰ç¼€)
\labelformat{figure}{å›¾~#1}
\labelformat{table}{è¡¨~#1}
\labelformat{equation}{å¼~(#1)}

% [7.5] ç¬¦å·é‡å®šä¹‰
\renewcommand{\leq}{\leqslant}
\renewcommand{\geq}{\geqslant}

% [7.6] ä¸Šæ ‡å¼•ç”¨æŒ‡ä»¤ (upcite)
% åŠŸèƒ½ï¼šç”Ÿæˆå³ä¸Šè§’æ ‡æ³¨ï¼Œå¦‚ "æ–‡çŒ®[1]"ï¼Œæ”¯æŒç‚¹å‡»è·³è½¬
% åŸç†ï¼šåˆ©ç”¨ textsuperscript å°† natbib çš„ cite è¾“å‡ºæŠ¬å‡
\newcommand{\upcite}[1]{%
	\textsuperscript{\cite{#1}}%
}




% ---------------------------------------------------------
% 8. PDF å±æ€§è®¾ç½®
% ---------------------------------------------------------
\hypersetup{
	hidelinks,          % éšè—é“¾æ¥è¾¹æ¡†å’Œé¢œè‰²
	colorlinks=false,   % ä¸ä½¿ç”¨å½©è‰²é“¾æ¥
	bookmarksnumbered=true,
	bookmarksopen=true,
	pdfstartview=FitH
}

% ---------------------------------------------------------
% 9. ç‰¹æ®ŠåŠŸèƒ½ç¯å¢ƒ (æ‘˜è¦ã€å‚è€ƒæ–‡çŒ®ã€é™„å½•ã€ä»»åŠ¡ä¹¦ã€å°é¢)
% ---------------------------------------------------------

% [9.1] æ‘˜è¦ç¯å¢ƒ
\newenvironment{cnabstract}[1]{
	\def\@keyword{#1}
	\clearpage
	\phantomsection
	\addcontentsline{toc}{section}{æ‘˜è¦} % åŠ å…¥ç›®å½•
	\begin{center} \heiti\zihao{3} \@title \end{center}
	\vspace{1ex}
	\begin{center} \heiti\zihao{4} æ‘˜ã€€è¦ \end{center}
	\par
}{
	\par\vspace{2ex}
	\noindent{\heiti\zihao{-4} å…³é”®è¯ï¼š}\@keyword
	\newpage
}

% [9.2] å‚è€ƒæ–‡çŒ®è‡ªåŠ¨åŒ–
\newcommand{\MyBibliography}[1]{
	\clearpage
	\phantomsection
	\addcontentsline{toc}{section}{å‚è€ƒæ–‡çŒ®}
	% ä¸´æ—¶ç¦ç”¨ section å‘½ä»¤ï¼Œé˜²æ­¢ bibliography è‡ªåŠ¨äº§ç”Ÿå¤§æ ‡é¢˜
	\renewcommand{\section}[2]{}%
	\bibliographystyle{plain} 
	\bibliography{#1}
}

% æ‰‹åŠ¨å‚è€ƒæ–‡çŒ®ç¯å¢ƒé‡å®šä¹‰
\renewenvironment{thebibliography}[1]{
	\section*{å‚è€ƒæ–‡çŒ®}
	\addcontentsline{toc}{section}{å‚è€ƒæ–‡çŒ®}
	\list{\@biblabel{\@arabic\c@enumiv}}%
	{\settowidth\labelwidth{\@biblabel{#1}}%
		\leftmargin\labelwidth
		\advance\leftmargin\labelsep
		\usecounter{enumiv}%
		\let\p@enumiv\@empty
		\renewcommand\theenumiv{\@arabic\c@enumiv}}%
	\sloppy
	\clubpenalty4000
	\widowpenalty4000
	\sfcode`\.\@m}
{\def\@noitemerr
	{\@latex@warning{Empty `thebibliography' environment}}%
	\endlist}

% [9.3] é™„å½•ç¯å¢ƒ (ä¿®å¤ç‰ˆ)
\newenvironment{appendixblock}{
	\clearpage
	\phantomsection
	\addcontentsline{toc}{section}{é™„å½•} % åœ¨ç›®å½•æ·»åŠ "é™„å½•"æ¡ç›®
	
	\setcounter{section}{0}     % é‡ç½®ç« èŠ‚è®¡æ•°
	\setcounter{subsection}{0}
	
	% é™„å½•ç¼–å·æ”¹ä¸º A, B, C...
	\renewcommand{\thesection}{\Alph{section}} 
	
	% ä¿®æ”¹ section åœ¨æ­£æ–‡ä¸­çš„æ˜¾ç¤ºæ ¼å¼ (å¦‚: é™„å½•A)
	\ctexset{
		section = {
			name = {é™„å½•,},
			number = \thesection,
			format = \centering\zihao{4}\heiti\bfseries
		}
	}
	
	% ä¿®æ”¹ section åœ¨ç›®å½•ä¸­çš„æ˜¾ç¤ºæ ¼å¼
	\titlecontents{section}[0pt]
	{\addvspace{6pt}\bfseries\heiti\zihao{4}}
	{é™„å½•\thecontentslabel\quad} 
	{}
	{\titlerule*[0.5pc]{.}\contentspage}
}{}




% [9.5] å°é¢ç”Ÿæˆæ¨¡å—
% è¾…åŠ©å‘½ä»¤: æ™ºèƒ½å¡«ç©ºä¸‹åˆ’çº¿
% é€»è¾‘: å†…å®¹çŸ­æ—¶å±…ä¸­åŠ ä¸‹åˆ’çº¿ï¼Œå†…å®¹é•¿æ—¶è‡ªåŠ¨æ¢è¡Œæ¯è¡ŒåŠ ä¸‹åˆ’çº¿
% ---------------------------------------------------------
% 8. å°é¢ä¸ä»»åŠ¡ä¹¦æ¨¡å—
% ---------------------------------------------------------

% è¾…åŠ©ï¼šæ™ºèƒ½ä¸‹åˆ’çº¿
\newcommand{\CoverInfo}[1]{%
	\begin{minipage}[t]{10.5cm} 
		\centering 
		\renewcommand{\arraystretch}{1.2}
		\sbox0{#1}%
		\ifdim\wd0<10.4cm 
		\uline{\makebox[10.4cm][c]{#1}}%
		\else
		\parbox[t]{10.5cm}{\centering\uline{#1}}%
		\fi
	\end{minipage}
}

% [ä»»åŠ¡ä¹¦ç”Ÿæˆ]
% ---------------------------------------------------------
% [æ”¯æŒè·¨é¡µç‰ˆ] ä»»åŠ¡ä¹¦ç”Ÿæˆæ¨¡å— (åŸºäº xltabular)
% è§£å†³ï¼šå†…å®¹è¿‡é•¿æ— æ³•è‡ªåŠ¨æ¢é¡µã€åº•éƒ¨å†…å®¹ä¸¢å¤±é—®é¢˜
% ---------------------------------------------------------
\newcommand{\maketaskbook}{
	\clearpage
	\phantomsection
	\addcontentsline{toc}{section}{ä»»åŠ¡ä¹¦}
	\thispagestyle{empty} % é¦–é¡µæ— é¡µç 
	
	% 1. æ ‡é¢˜åŒºåŸŸ
	\begin{center}
		\vspace*{-1.5cm} 
		\zihao{2}\bfseries\heiti ä»»åŠ¡ä¹¦
	\end{center}
	\vspace{0.3cm} 
	
	% 2. è¡¨æ ¼è®¾ç½®
	\zihao{-4}\songti
	\renewcommand{\arraystretch}{1.35} 
	
	% 3. å¼€å§‹ xltabular ç¯å¢ƒ (ç”¨æ³•ç±»ä¼¼ tabularxï¼Œä½†æ”¯æŒè·¨é¡µ)
	% åˆ—å®šä¹‰ï¼š
	% 1. æ ‡ç­¾åˆ— 1.6cm
	% 2. ç»„é•¿åˆ— 3.0cm (å›ºå®šå®½)
	% 3. æ ‡ç­¾åˆ— 1.6cm
	% 4. é˜Ÿå‘˜åˆ— X (è‡ªé€‚åº”å‰©ä½™)
	\begin{xltabular}{\textwidth}{|p{1.6cm}<{\centering}|p{3.0cm}<{\centering}|p{1.6cm}<{\centering}|X|}
		
		% --- A. é¦–é¡µè¡¨å¤´å®šä¹‰ ---
		\hline
		\bfseries ç»„é•¿ & \@author & 
		\bfseries é˜Ÿå‘˜ & \raggedright\arraybackslash \@team \\
		\hline
		\bfseries è®¾è®¡é¢˜ç›® & \multicolumn{3}{p{\dimexpr\textwidth-2.2cm\relax}|}{%
			\centering \vspace{0.2em} \@title \vspace{0.2em}%
		} \\
		\hline
		\endfirsthead % é¦–é¡µè¡¨å¤´ç»“æŸ
		
		% --- B. ç»­é¡µè¡¨å¤´å®šä¹‰ (å¦‚æœè·¨é¡µï¼Œç¬¬äºŒé¡µé¡¶éƒ¨æ˜¾ç¤ºè¿™ä¸ª) ---
		\multicolumn{4}{r}{\zihao{5}\kaishu ï¼ˆç»­è¡¨ï¼‰} \\ 
		\hline
		\endhead % ç»­é¡µè¡¨å¤´ç»“æŸ
		
		% --- C. é¡µè„šå®šä¹‰ ---
		\hline
		\endfoot % æ¯é¡µåº•éƒ¨çš„çº¿
		
		% --- D. æœ€åä¸€é¡µé¡µè„š ---
		\hline
		\endlastfoot % æœ€åä¸€é¡µåº•éƒ¨çš„çº¿
		
		% --- E. è¡¨æ ¼æ­£æ–‡å†…å®¹ ---
		
		% [è°ƒæŸ¥ç›®æ ‡]
		\bfseries è°ƒæŸ¥ç›®æ ‡ & \multicolumn{3}{p{\dimexpr\textwidth-2.2cm\relax}|}{%
			\vspace{0.3em}\taskTargetText\vspace{0.3em}
		} \\
		\hline
		
		% [è°ƒæŸ¥å¯¹è±¡]
		\bfseries è°ƒæŸ¥å¯¹è±¡ & \multicolumn{3}{l|}{é»‘é¾™æ±Ÿç§‘æŠ€å¤§å­¦åœ¨è¯»æœ¬ç§‘ç”Ÿï¼Œæœ‰æ•ˆæ ·æœ¬ 205 ä»½ã€‚} \\
		\hline
		
		% [æ–¹æ¡ˆè®¾è®¡] (è¿™é‡Œå†…å®¹é€šå¸¸æœ€é•¿ï¼Œä¼šè‡ªåŠ¨è·¨é¡µ)
		\bfseries æ–¹æ¡ˆè®¾è®¡ & \multicolumn{3}{p{\dimexpr\textwidth-2.2cm\relax}|}{%
			\vspace{0.3em}\taskContentText\vspace{0.3em}
		} \\
		\hline
		
		% [é¢„æœŸç»“æœ]
		\bfseries é¢„æœŸç»“æœ & \multicolumn{3}{p{\dimexpr\textwidth-2.2cm\relax}|}{%
			\vspace{0.3em}\taskExpectedText\vspace{0.3em}
		} \\
		\hline
		
		% [è®¡åˆ’è¿›åº¦]
		\bfseries è®¡åˆ’è¿›åº¦ & \multicolumn{3}{p{\dimexpr\textwidth-2.2cm\relax}|}{%
			\vspace{0.3em}\taskScheduleText\vspace{0.3em}
		} \\
		
	\end{xltabular}
	\newpage
}

% [å°é¢ç”Ÿæˆ]
\newcommand{\makecover}{
	\begin{titlepage}
		\begin{tikzpicture}[remember picture, overlay]
			\node[anchor=north east, xshift=-2cm, yshift=-2cm] at (current page.north east) {
				\setkeys{Gin}{draft=false} 
				\IfFileExists{assets/logo.png}{\includegraphics[width=0.25\textwidth]{assets/logo.png}}{
					\IfFileExists{figure/assets/logo.png}{\includegraphics[width=0.25\textwidth]{figure/assets/logo.png}}{}}
			};
		\end{tikzpicture}
		
		\vspace*{1cm}
		\centering
		
		\begin{flushright}
			\zihao{4}\bfseries\@reportID
		\end{flushright}
		\vspace{1.5cm} % è°ƒæ•´é—´è·
		
		{\zihao{1}\bfseries\heiti é»‘é¾™æ±Ÿç§‘æŠ€å¤§å­¦\par}
		\vspace{1.5cm}
		{\fontsize{36pt}{36pt}\bfseries\songti ç¤¾ä¼šè°ƒæŸ¥æŠ¥å‘Š \par}
		\vspace{2.5cm}
		
		\zihao{3}\songti
		\renewcommand{\arraystretch}{2.0} 
		
		\begin{tabular}{r l} 
			\textbf{é¢˜\quad ç›®} & \CoverInfo{\@title} \\ 
			% [å…³é”®ä¿®æ”¹] è¿™é‡ŒåŒæ—¶æ˜¾ç¤ºç»„é•¿å’Œé˜Ÿå‘˜
			\textbf{å§“\quad å} & \CoverInfo{\@authorã€\@team} \\ 
			\textbf{é™¢ (ç³»)}    & \CoverInfo{\@dept} \\
			\textbf{ä¸“ä¸šã€å¹´çº§} & \CoverInfo{\@major} \\
			\textbf{æŒ‡å¯¼æ•™å¸ˆ}   & \CoverInfo{\@advisor} \\
		\end{tabular}
		
		\vfill
		{\zihao{3}\songti \today}
		\vspace{2cm}
	\end{titlepage}
}

% ---------------------------------------------------------
% 10. é«˜çº§å›¾æ–‡æ··æ’ä¸å¤šå›¾ç¯å¢ƒ (æœ€ç»ˆä¿®å¤ç‰ˆ)
% ---------------------------------------------------------
\RequirePackage{xparse}    % å¼•å…¥é«˜çº§å‚æ•°å¤„ç†å®åŒ…

% [10.1] å›¾æ–‡æ··æ’ç¯å¢ƒ (textfigure)
% è¯­æ³•: \begin{textfigure}[ä½ç½®]{å›¾ç‰‡è·¯å¾„}{æ ‡é¢˜}[å®½åº¦æ¯”ä¾‹]
	\newsavebox{\tf@textbox}
	\newlength{\tf@imagew}
	\newlength{\tf@textw}
	
	% ğŸ’¡ å®šä¹‰ç”¨äºæ¯”è¾ƒçš„å¸¸é‡
	\def\tf@left{left}
	
	\NewDocumentEnvironment{textfigure}{O{right} m m O{0.4}}{%
		\def\tf@pos{#1}%
		\def\tf@path{#2}%
		\def\tf@cap{#3}%
		\setlength{\tf@imagew}{#4\textwidth}%
		
		% è®¡ç®—æ–‡å­—å®½åº¦ = æ€»å®½åº¦ - å›¾ç‰‡å®½åº¦ - é—´è·
		\setlength{\tf@textw}{\textwidth}%
		\addtolength{\tf@textw}{-\tf@imagew}%
		\addtolength{\tf@textw}{-1.5em}%
		
		% å¼€å§‹æ•è·æ–‡å­—
		\begin{lrbox}{\tf@textbox}%
			\begin{minipage}{\tf@textw}%
				\setlength{\parindent}{2em}%
				\linespread{1.5}\selectfont%
			}{%
			\end{minipage}%
		\end{lrbox}%
		
		\par\vspace{1em}\noindent
		% ğŸ’¡ ä½¿ç”¨ \ifx æ¯”è¾ƒå®å±•å¼€åçš„å†…å®¹
		\ifx\tf@pos\tf@left
		% === å·¦å›¾å³æ–‡ ===
		\begin{minipage}[c]{\tf@imagew}
			\centering
			\includegraphics[width=\linewidth]{\tf@path}
			% ä¸´æ—¶ç¦ç”¨ hypcap è§£å†³è­¦å‘Šï¼Œä½¿ç”¨ captionof ç”Ÿæˆæ ‡é¢˜
			\captionsetup{hypcap=false}%
			\captionof{figure}{\tf@cap}
		\end{minipage}%
		\hfill
		\usebox{\tf@textbox}
		\else
		% === å³å›¾å·¦æ–‡ ===
		\usebox{\tf@textbox}%
		\hfill
		\begin{minipage}[c]{\tf@imagew}
			\centering
			\includegraphics[width=\linewidth]{\tf@path}
			\captionsetup{hypcap=false}%
			\captionof{figure}{\tf@cap}
		\end{minipage}
		\fi
		\par\vspace{1em}
	}
	
	% [10.2] å¼ºåŠ›å¹¶è¡Œå›¾ç‰‡ç¯å¢ƒ (parallelfigures)
	% ä¿®å¤é‡ç‚¹ï¼šæ”¹ç”¨ subfigure ç¯å¢ƒï¼Œè§£å†³ Package caption Error
	\newcommand{\pf@maincap}{}
	
	\NewDocumentEnvironment{parallelfigures}{m}{%
		\renewcommand{\pf@maincap}{#1}%
		\begin{figure}[H] % å¼ºåˆ¶ä½ç½®
			\centering
			% å®šä¹‰å†…éƒ¨å¿«æ·å‘½ä»¤ \addfig[å®½åº¦]{è·¯å¾„}{æ ‡é¢˜}
			\newcommand{\addfig}[3][0.48]{%
				% ä½¿ç”¨ subfigure ç¯å¢ƒ (ç”± subcaption å®åŒ…æä¾›)
				% [b] è¡¨ç¤ºåº•éƒ¨å¯¹é½ï¼Œé¿å…é•¿çŸ­ä¸ä¸€æ—¶çš„é”™ä½
				\begin{subfigure}[b]{##1\textwidth} 
					\centering
					\includegraphics[width=\linewidth]{##2}
					\caption{##3} % è¿™é‡Œçš„ caption ç°åœ¨æ˜¯å®‰å…¨çš„
				\end{subfigure}%
				\hspace{\fill}% è‡ªåŠ¨é—´éš”
			}%
		}{%
			\caption{\pf@maincap}%
		\end{figure}%
	}

	% [10.3] ç®€æ´å¤šå›¾è¡Œç¯å¢ƒ (figurerow)
	% ç”¨æ³•: \begin{figurerow}{æ€»æ ‡é¢˜}{åˆ—æ•°}
	%           \figitem{è·¯å¾„}{å­æ ‡é¢˜}
	%           \figitem{è·¯å¾„}{å­æ ‡é¢˜}
	%       \end{figurerow}
	\newcommand{\fr@maincap}{}
	\newcommand{\fr@cols}{2}
	
	\NewDocumentEnvironment{figurerow}{m O{2}}{%
		\renewcommand{\fr@maincap}{#1}%
		\renewcommand{\fr@cols}{#2}%
		\begin{figure}[H]
			\centering
			% æ ¹æ®åˆ—æ•°è®¡ç®—å®½åº¦
			\newlength{\fr@width}%
			\setlength{\fr@width}{\dimexpr(\textwidth-1em*#2)/#2\relax}%
			% å®šä¹‰å†…éƒ¨å‘½ä»¤
			\newcommand{\figitem}[2]{%
				\begin{subfigure}[b]{\fr@width}
					\centering
					\includegraphics[width=\linewidth]{##1}
					\caption{##2}
				\end{subfigure}\hfill
			}%
		}{%
			\caption{\fr@maincap}
		\end{figure}
	}

	% [10.4] ç½‘æ ¼å›¾ç‰‡ç¯å¢ƒ (figuregrid) - æ”¯æŒ2x2, 2x3ç­‰ç½‘æ ¼å¸ƒå±€
	% ç”¨æ³•: \begin{figuregrid}{æ€»æ ‡é¢˜}
	%           \gridrow{
	%               \gridfig{è·¯å¾„}{å­æ ‡é¢˜}
	%               \gridfig{è·¯å¾„}{å­æ ‡é¢˜}
	%           }
	%       \end{figuregrid}
	\newcommand{\fg@maincap}{}
	
	\NewDocumentEnvironment{figuregrid}{m}{%
		\renewcommand{\fg@maincap}{#1}%
		\begin{figure}[H]
			\centering
			% å®šä¹‰ç½‘æ ¼è¡Œå‘½ä»¤
			\newcommand{\gridrow}[1]{%
				##1\par\vspace{0.5em}%
			}%
			% å®šä¹‰ç½‘æ ¼å•å…ƒå‘½ä»¤ [å®½åº¦]{è·¯å¾„}{æ ‡é¢˜}
			\newcommand{\gridfig}[3][0.48]{%
				\begin{subfigure}[b]{##1\textwidth}
					\centering
					\includegraphics[width=\linewidth]{##2}
					\caption{##3}
				\end{subfigure}\hfill
			}%
		}{%
			\caption{\fg@maincap}
		\end{figure}
	}



% 11. ä¸“ä¸šä»£ç ç¯å¢ƒé…ç½® (æœ€ç»ˆç¨³å®šç‰ˆï¼šç§»é™¤å†²çªé…ç½®)
% ---------------------------------------------------------
\RequirePackage{listings}
\RequirePackage{xcolor}
% å¼•å…¥ breakable æ”¯æŒè·¨é¡µ, skins æ”¯æŒé˜´å½±
\RequirePackage[most,listings,xparse,breakable]{tcolorbox}

% [11.1] å®šä¹‰å…¨å±€å…±äº«è®¡æ•°å™¨
\newcounter{hustcode}[section] 
\renewcommand{\thehustcode}{\thesection-\arabic{hustcode}}

% [11.2] è§†è§‰é…è‰² (ä»¿ VSCode Light)
\definecolor{hust@codeback}{RGB}{250,250,250}   % äº®ç°èƒŒæ™¯
\definecolor{hust@codeframe}{RGB}{220,220,220}  % è¾¹æ¡†é¢œè‰²
\definecolor{hust@keyword}{RGB}{0,92,197}       % å…³é”®å­—è“
\definecolor{hust@comment}{RGB}{80,161,79}      % æ³¨é‡Šç»¿
\definecolor{hust@string}{RGB}{227,17,108}      % å­—ç¬¦ä¸²çº¢
\definecolor{hust@number}{RGB}{160,160,160}     % è¡Œå·ç°

% [11.3] æ ¸å¿ƒ listings æ ·å¼é…ç½®
\lstdefinestyle{huststyle}{
	basicstyle=\small\ttfamily, % å­—å·ä¸ç­‰å®½å­—ä½“
	keywordstyle=\bfseries\color{hust@keyword},
	commentstyle=\itshape\color{hust@comment},
	stringstyle=\color{hust@string},
	numberstyle=\tiny\color{hust@number},
	numbers=left,      % æ˜¾ç¤ºè¡Œå·
	numbersep=10pt,    % è¡Œå·ä¸ä»£ç é—´è·
	stepnumber=1,
	breaklines=true,   % è‡ªåŠ¨æ¢è¡Œ
	breakatwhitespace=false,
	showstringspaces=false,
	showtabs=false,    % ä¸æ˜¾ç¤º Tab æ ‡è®°
	captionpos=b,
	frame=none,
	% [å…³é”®é…ç½® 1] ç¬¦å·ä¸å…¼å®¹æ€§
	extendedchars=false, % è§£å†³ä¸­æ–‡æ³¨é‡ŠæŠ¥é”™
	escapechar=,         % [æ ¸å¿ƒä¿®å¤] æ¸…ç©ºè½¬ä¹‰ç¬¦ï¼é˜²æ­¢ @ ç¬¦å·ç ´åä»£ç è§£æ
	upquote=true,        % ä½¿ç”¨ç›´å¼•å·
	% [å…³é”®é…ç½® 2] ç¼©è¿›ä¸åŸæ ·è¾“å‡º
	tabsize=4,           % Tab = 4 ç©ºæ ¼ (listings ä¼šè‡ªåŠ¨å¤„ç†ï¼Œæ— éœ€ literate)
	keepspaces=true,     % ä¸¥æ ¼ä¿ç•™ä»£ç ç¼©è¿›
	mathescape=false,    % å…³é—­æ•°å­¦æ¨¡å¼ï¼Œç¡®ä¿ $ åŸæ ·è¾“å‡º
	texcl=false,         % å…³é—­ TeX æ³¨é‡Šï¼Œç¡®ä¿ % åŸæ ·è¾“å‡º
	columns=flexible     % å¼¹æ€§åˆ—å®½ï¼Œé˜²æ­¢å¤åˆ¶ä¹±ç 
	% [å…³é”®æ“ä½œ] å·²åˆ é™¤ literate é€‰é¡¹ï¼Œè§£å†³ Improper alphabetic constant æŠ¥é”™
}

% [11.4] é€šç”¨ tcolorbox å¤–è§‚å®šä¹‰ (Mac é£æ ¼ + æ ‡å‡†é˜´å½±)
\tcbset{
	hustcodestyle/.style={
		enhanced,
		breakable,         % å…è®¸ä»£ç è·¨é¡µ
		colback=hust@codeback,
		colframe=hust@codeframe,
		listing only,
		% æ ‡é¢˜æ ·å¼
		title={\textbf{ä»£ç  \thehustcodeï¼š}#1},
		coltitle=black,
		fonttitle=\bfseries\heiti\small,
		attach boxed title to top center={yshift=-3mm},
		boxed title style={
			colback=white, 
			colframe=hust@codeframe, 
			boxrule=0.5pt,
			arc=3pt,
			drop shadow % ä½¿ç”¨æ ‡å‡†é˜´å½±
		},
		% æ•´ä½“ç›’å­æ ·å¼
		sharp corners, 
		rounded corners=southeast, 
		arc=5pt,
		top=12pt, bottom=2pt, left=6pt, right=6pt, 
		boxrule=0.8pt,
		drop shadow, 
		% [è£…é¥°] Mac é£æ ¼ä¸‰è‰²ç‚¹
		overlay unbroken and first={
			\draw[fill=red!70!white, draw=none] ([xshift=6mm,yshift=-1.5mm]frame.north west) circle (2.5pt);
			\draw[fill=yellow!70!white, draw=none] ([xshift=11mm,yshift=-1.5mm]frame.north west) circle (2.5pt);
			\draw[fill=green!70!white, draw=none] ([xshift=16mm,yshift=-1.5mm]frame.north west) circle (2.5pt);
		}
	}
}

% [11.5] ç¯å¢ƒ: codeblock (ç›´æ¥åœ¨ tex ä¸­å†™ä»£ç )
\newtcblisting{codeblock}[2][c]{
	hustcodestyle={#2},
	listing engine=listings,
	listing options={style=huststyle, language=#1},
	code={\refstepcounter{hustcode}} 
}

% [11.6] å‘½ä»¤: \filecode (ä»å¤–éƒ¨æ–‡ä»¶å¯¼å…¥)
\NewDocumentCommand{\filecode}{O{c} m m}{%
	\refstepcounter{hustcode}% 
	\tcbinputlisting{
		hustcodestyle={#2},
		listing engine=listings,
		listing file={#3},
		listing options={style=huststyle, language=#1}
	}%
}


% ---------------------------------------------------------
% 12. è‹±æ–‡æ‘˜è¦ç¯å¢ƒ (æ¯•è®¾å¿…é€‰)
% ---------------------------------------------------------
\newenvironment{enabstract}[1]{
	\def\@enkeyword{#1}
	\clearpage
	\phantomsection
	\addcontentsline{toc}{section}{Abstract} % åŠ å…¥ç›®å½•
%	\begin{center} \bfseries\zihao{3} \@title \end{center}
	\vspace{1ex}
	\begin{center} \bfseries\zihao{4} Abstract \end{center}
	\par
	\linespread{1.5}\selectfont % è‹±æ–‡è¡Œè·è°ƒæ•´
	\zihao{-4} % å°å››å·å­—
}{
	\par\vspace{2ex}
	\noindent\textbf{Keywords: } \@enkeyword
	\newpage
}

% ---------------------------------------------------------
% 13. ä¼ªä»£ç /ç®—æ³•ç¯å¢ƒ (æ±‰åŒ–é…ç½®)
% ---------------------------------------------------------
\RequirePackage{algorithm}
\RequirePackage{algorithmicx}
\RequirePackage{algpseudocode}

% [13.1] æ±‰åŒ–ä¸é…ç½®
\floatname{algorithm}{ç®—æ³•} % æ ‡é¢˜ç”± Algorithm 1 å˜ä¸º ç®—æ³• 1
\renewcommand{\algorithmicrequire}{\textbf{è¾“å…¥ï¼š}}
\renewcommand{\algorithmicensure}{\textbf{è¾“å‡ºï¼š}}

% [13.2] ç¾åŒ–è®¾ç½® (è®©å®ƒé•¿å¾—åƒæ•™æé‡Œçš„æ ·å­)
% å¦‚æœéœ€è¦ç»™ç®—æ³•åŠ æ¡†ï¼Œå¯ä»¥ä½¿ç”¨ algorithm è‡ªå¸¦çš„ float å±æ€§ï¼Œ
% æˆ–è€…åƒä¸‹é¢è¿™æ ·å®šä¹‰æ›´ç´§å‡‘çš„æ ·å¼
\algrenewcommand\algorithmicindent{2.0em}% ç¼©è¿›é‡

% ---------------------------------------------------------
% 14. ç²¾ç¾æç¤ºæ¡†ä¸å®šç†ç¯å¢ƒ (é£æ ¼åŒ¹é…ä»£ç å—)
% ---------------------------------------------------------
% åŸºäº tcolorbox å®šä¹‰ï¼Œç”¨äºâ€œå®šä¹‰â€ã€â€œæ³¨æ„â€ã€â€œç»“è®ºâ€
\tcbset{
	commonbox/.style={
		enhanced,
		breakable,
		sharp corners,
		rounded corners=southeast,
		arc=4pt,
		boxrule=1pt,
		drop shadow,
		attach boxed title to top left={yshift=-2mm, xshift=5mm},
		boxed title style={boxrule=0pt, colframe=white, colback=white},
		fonttitle=\bfseries\heiti,
		top=12pt
	}
}

% [14.1] æç¤º/æ³¨æ„æ¡† (è“è‰²ç³»)
% ç”¨æ³•: \begin{notice}{æ ‡é¢˜} ... \end{notice}
\newtcolorbox{notice}[1]{
	commonbox,
	colback=Azure1,      % èƒŒæ™¯æ·¡è“
	colframe=DodgerBlue3,% è¾¹æ¡†æ·±è“
	coltitle=DodgerBlue3,
	title={ã€æ³¨æ„ã€‘#1}
}

% [14.2] æ¦‚å¿µ/å®šä¹‰æ¡† (ç»¿è‰²ç³»)
% ç”¨æ³•: \begin{definition}{æœ¯è¯­åç§°} ... \end{definition}
\newtcolorbox{definition}[1]{
	commonbox,
	colback=Honeydew1,    % èƒŒæ™¯æ·¡ç»¿
	colframe=ForestGreen, % è¾¹æ¡†æ·±ç»¿
	coltitle=ForestGreen,
	title={ã€å®šä¹‰ã€‘#1}
}

% [14.3] ç»“è®º/é‡ç‚¹æ¡† (çº¢è‰²ç³»)
% ç”¨æ³•: \begin{conclusion}{ç»“è®º} ... \end{conclusion}
\newtcolorbox{conclusion}[1]{
	commonbox,
	colback=LavenderBlush1, % èƒŒæ™¯æ·¡çº¢
	colframe=Crimson,       % è¾¹æ¡†æ·±çº¢
	coltitle=Crimson,
	title={ã€ç»“è®ºã€‘#1}
}

% ---------------------------------------------------------
% 15. è‡´è°¢ç¯å¢ƒ
% ---------------------------------------------------------
\newenvironment{acknowledgement}{
	\clearpage
	\phantomsection
	\addcontentsline{toc}{section}{è‡´è°¢}
	\section*{è‡´è°¢}
	\zihao{-4}\songti\linespread{1.5}\selectfont
}{
	\par
}

% ---------------------------------------------------------
% 16. åˆ—è¡¨ç¯å¢ƒä¼˜åŒ– (ä¸“ä¸šå‡ºç‰ˆçº§å®šåˆ¶)
% ---------------------------------------------------------
\RequirePackage{enumitem}
\RequirePackage{tikz} 
\RequirePackage{amssymb} % è¡¥å……æ•°å­¦ç¬¦å·

% [16.0] ä¸“ä¸šç»˜å›¾å¾®è°ƒ (Visual Assets)
% 1. ä¸€çº§åˆ—è¡¨æ ‡å·ï¼šå®å¿ƒæ–¹å— (åŸºçº¿å¾®è°ƒï¼Œè®©å®ƒæ­£å¯¹æ–‡å­—ä¸­é—´)
\newcommand{\hust@item@square}{%
	\tikz[baseline=-0.6ex] \node[fill=black, shape=rectangle, inner sep=0pt, minimum size=0.5em] {};%
}

% 2. äºŒçº§åˆ—è¡¨æ ‡å·ï¼šæ·±ç°åœ†ç‚¹ (è§†è§‰é™å™ª)
\newcommand{\hust@item@circle}{%
	\tikz[baseline=-0.6ex] \node[fill=darkgray, shape=circle, inner sep=0pt, minimum size=0.35em] {};%
}

% 3. ä¸‰çº§åˆ—è¡¨æ ‡å·ï¼šç»†é•¿æ¨ªçº¿ (å¼•å¯¼çº¿)
\newcommand{\hust@item@dash}{%
	\tikz[baseline=-0.6ex] \draw[line width=0.8pt] (0,0) -- (0.5em,0);%
}

% 4. åºå·ç»˜åˆ¶ (æ–¹å—åç™½ / åœ†åœˆæ•°å­—)
\newcommand{\hust@circled}[1]{%
	\begin{tikzpicture}[baseline=(char.base)]
		\node[shape=circle, draw=black, inner sep=0.5pt, minimum size=1.2em, line width=0.6pt] (char) {\small\bfseries #1};
	\end{tikzpicture}%
}
\newcommand{\hust@squared}[1]{%
	\begin{tikzpicture}[baseline=(char.base)]
		\node[shape=rectangle, draw=black, fill=black, text=white, rounded corners=2pt, inner sep=1pt, minimum size=1.2em] (char) {\small\bfseries #1};
	\end{tikzpicture}%
}

% [16.1] å…¨å±€åŸºç¡€å‚æ•°è®¾ç½®
\setlist{
	nosep, % ç´§å‡‘æ¨¡å¼åŸºç¡€
	itemsep=3pt,  % æ¡ç›®é—´å¾®è· (å¢åŠ å‘¼å¸æ„Ÿ)
	parsep=0pt,   % æ®µå†…æ— é—´è·
	topsep=4pt,   % åˆ—è¡¨ä¸æ­£æ–‡é—´è·
	partopsep=0pt
}

% [16.2] æ— åºåˆ—è¡¨æ·±åº¦å®šåˆ¶ (Itemize)
% Level 1: å®å¿ƒæ–¹å— -> å¼ºè°ƒç»“æ„æ„Ÿ
\setlist[itemize,1]{
	label=\protect\hust@item@square,
	leftmargin=2.0em, labelsep=0.6em
}
% Level 2: æ·±ç°åœ†ç‚¹ -> å¼ºè°ƒå­é›†å…³ç³»ï¼Œé¢œè‰²å˜æµ…
\setlist[itemize,2]{
	label=\protect\hust@item@circle,
	leftmargin=1.8em, labelsep=0.6em
}
% Level 3: çŸ­æ¨ªçº¿ -> å¼ºè°ƒå±æ€§æˆ–å‚æ•°
\setlist[itemize,3]{
	label=\protect\hust@item@dash,
	leftmargin=1.8em, labelsep=0.6em
}

% [16.3] æœ‰åºåˆ—è¡¨æ·±åº¦å®šåˆ¶ (Enumerate)
% é»˜è®¤æ ·å¼ä¼˜åŒ–ï¼š1. å­—ä½“å¯¹é½
\setlist[enumerate,1]{
	label=\arabic*.,
	leftmargin=2.0em, labelsep=0.5em
}
\setlist[enumerate,2]{
	label=(\arabic*),
	leftmargin=2.0em, labelsep=0.5em
}

% [16.4] è‡ªå®šä¹‰æ ·å¼ï¼šæ‹¬å·åˆ—è¡¨ (enumpar)
\newlist{enumpar}{enumerate}{1}
\setlist[enumpar]{
	label=(\arabic*),
	leftmargin=2.5em, labelsep=0.5em, itemsep=2pt, align=left
}

% [16.5] è‡ªå®šä¹‰æ ·å¼ï¼šåŠæ‹¬å·åˆ—è¡¨ (enumbra)
\newlist{enumbra}{enumerate}{1}
\setlist[enumbra]{
	label=\arabic*),
	leftmargin=2.5em, labelsep=0.5em, itemsep=2pt, align=left
}

% [16.6] è‡ªå®šä¹‰æ ·å¼ï¼šåœ†åœˆåºå· (enumcircled) -> â‘ 
\newlist{enumcircled}{enumerate}{1}
\setlist[enumcircled]{
	label=\protect\hust@circled{\arabic*},
	leftmargin=2.8em, labelsep=0.6em, itemsep=3pt
}

% [16.7] è‡ªå®šä¹‰æ ·å¼ï¼šé»‘å—åºå· (enumsquared) -> 1ï¸âƒ£
\newlist{enumsquared}{enumerate}{1}
\setlist[enumsquared]{
	label=\protect\hust@squared{\arabic*},
	leftmargin=2.8em, labelsep=0.6em, itemsep=3pt
}

% ---------------------------------------------------------
% 17. é”¦ä¸Šæ·»èŠ±çš„åŠŸèƒ½ (ç›®å½•æ ‘ã€è·¨é¡µæ‰¹æ³¨ã€å…ƒæ•°æ®)
% ---------------------------------------------------------

% [17.1] é¡¹ç›®ç›®å½•æ ‘ç»˜åˆ¶
\RequirePackage{dirtree}
\renewcommand{\DTstyle}{\ttfamily\small} 

% [17.2] å¾…åŠäº‹é¡¹ä¸æ‰¹æ³¨ (åŸºäº tcolorbox é‡æ„ï¼Œæ”¯æŒè·¨é¡µ)
% è¯´æ˜ï¼šåŸç‰ˆ todonotes ä¸æ”¯æŒå†…å®¹è·¨é¡µï¼Œè¿™é‡Œæ”¹ç”¨ breakable ç›’å­
\tcbset{
	hust@todostyle/.style={
		enhanced,
		breakable,       % [æ ¸å¿ƒ] å…è®¸è·¨é¡µ
		width=\textwidth,% å®½åº¦å æ»¡è¡Œ
		sharp corners,
		rounded corners=southeast,
		arc=3pt,
		boxrule=1pt,
		left=4pt, right=4pt, top=2pt, bottom=2pt,
		before skip=8pt, after skip=8pt, % ä¸æ­£æ–‡çš„é—´è·
		fonttitle=\bfseries\small,
		attach boxed title to top left={yshift=-2mm, xshift=3mm},
		boxed title style={boxrule=0pt, colframe=white}
	}
}

% å®šä¹‰ \todo{å†…å®¹} - æ©™è‰²ï¼Œç”¨äºæ™®é€šå¾…åŠ
\newcommand{\todo}[1]{%
	\begin{tcolorbox}[
		hust@todostyle, 
		colback=orange!5, 
		colframe=orange!80!black, 
		coltitle=orange!80!black,
		boxed title style={colback=orange!10},
		title={TODO (å¾…åŠ)}
		]
		#1
	\end{tcolorbox}%
}

% å®šä¹‰ \fixme{å†…å®¹} - çº¢è‰²ï¼Œç”¨äºäºŸéœ€ä¿®æ”¹çš„åœ°æ–¹
\newcommand{\fixme}[1]{%
	\begin{tcolorbox}[
		hust@todostyle, 
		colback=red!5, 
		colframe=red!75!black, 
		coltitle=red!75!black,
		boxed title style={colback=red!10},
		title={FIXME (éœ€ä¿®æ­£)}
		]
		#1
	\end{tcolorbox}%
}

% å®šä¹‰ \note{å†…å®¹} - è“è‰²ï¼Œç”¨äºè¡¥å……è¯´æ˜æˆ–å¤‡å¿˜
\newcommand{\note}[1]{%
	\begin{tcolorbox}[
		hust@todostyle, 
		colback=blue!5, 
		colframe=blue!65!black, 
		coltitle=blue!65!black, 
		boxed title style={colback=blue!10},
		title={NOTE (å¤‡æ³¨)}
		]
		#1
	\end{tcolorbox}%
}

% [17.3] æ™ºèƒ½ PDF å…ƒæ•°æ®æ³¨å…¥
\AtBeginDocument{
	\hypersetup{
		pdftitle={\@title},
		pdfauthor={\@author},
		pdfsubject={é»‘é¾™æ±Ÿç§‘æŠ€å¤§å­¦å®ä¹ æŠ¥å‘Š/æ¯•ä¸šè®¾è®¡},
		pdfcreator={HUST Report LaTeX Class}
	}
}

% =========================================================
% 18. é«˜çº§æ‰¹æ³¨ä¸å®¡é˜…ç³»ç»Ÿ (Review System - TikZ Absolute)
% =========================================================
% åŠŸèƒ½ï¼šæ”¯æŒä¾§è¾¹æ‰¹æ³¨ã€è¡Œé—´ï¼ˆä¸Šæ–¹/ä¸‹æ–¹ï¼‰æ‰¹æ³¨
% ä¿®å¤ï¼šè§£å†³äº† width å±æ€§æŠ¥é”™é—®é¢˜
% =========================================================

% --- 1. ä¾èµ–åº“åŠ è½½ ---
\RequirePackage{xparse}          % ç”¨äº \NewDocumentCommand
\RequirePackage[most]{tcolorbox} % ç”¨äº \tcbox (åœ†è§’æ¡†ç­‰)
\RequirePackage{tikz}            % ç»˜å›¾å¼•æ“
\RequirePackage{tikzpagenodes}   % è·å–é¡µé¢ç»å¯¹ä½ç½®
\RequirePackage[normalem]{ulem}  % ä¸‹åˆ’çº¿ä¸æ³¢æµªçº¿æ”¯æŒ

% --- 2. å‚æ•°å®šä¹‰ ---
\pgfkeys{
	/hustreview/.is family, /hustreview,
	style/.store in  = \hust@review@style,
	color/.store in  = \hust@review@color,
	side/.store in   = \hust@review@side,   % æ”¯æŒ left, right, below, above
	offset/.store in = \hust@review@offset, % å‚ç›´åç§»é‡
	style/.default   = underline,
	color/.default   = red,
	side/.default    = right,
	offset/.default  = 0pt
}

% --- 3. ä¾§è¾¹æ‰¹æ³¨ç»˜åˆ¶å® (TikZ Overlay - ä¾§è¾¹æ¨¡å¼) ---
\newcommand{\hust@drawsidenote}[4]{%
	% #1: é¢œè‰², #2: å†…å®¹, #3: æ–¹å‘(left/right), #4: å‚ç›´åç§»
	\begin{tikzpicture}[remember picture, overlay]
		\ifdefstring{#3}{left}{%
			% === å·¦ä¾§ç»å¯¹å®šä½ ===
			% å…³é”®ä¿®å¤ï¼šä½¿ç”¨ text width æ›¿ä»£ widthï¼Œè§£å†³æŠ¥é”™
			\node[anchor=north, align=right, text width=2.0cm] 
			at ([xshift=1.5cm, yshift=#4]current page.west |- 0,0) {%
				\begingroup
				\color{#1}%
				\zihao{6}\songti\linespread{1.1}\selectfont
				\textbf{æ‰¹æ³¨} $\rightarrow$\\
				#2
				\endgroup
			};
		}{%
			% === å³ä¾§ç»å¯¹å®šä½ ===
			\node[anchor=north, align=left, text width=2.0cm] 
			at ([xshift=-1.5cm, yshift=#4]current page.east |- 0,0) {%
				\begingroup
				\color{#1}%
				\zihao{6}\songti\linespread{1.1}\selectfont
				$\leftarrow$ \textbf{æ‰¹æ³¨}\\
				#2
				\endgroup
			};
		}%
	\end{tikzpicture}%
}

% --- 4. è¡Œé—´æ‰¹æ³¨ç»˜åˆ¶å® (TikZ Overlay - è¡Œé—´æ¨¡å¼) ---
\newcommand{\hust@drawinlinenote}[4]{%
	% #1: é¢œè‰², #2: å†…å®¹, #3: æ–¹å‘(below/above), #4: å‚ç›´åç§»
	\begin{tikzpicture}[remember picture, overlay]
		\ifdefstring{#3}{above}{%
			% === ä¸Šæ–¹è¡Œé—´æ’å…¥ ===
			% anchor=south west: ä»åŸºçº¿å·¦ä¸Šè§’å‘ä¸Šç”Ÿé•¿
			\node[anchor=south west, inner sep=0pt, align=left, text width=8cm, yshift=0.8em+#4] 
			at (0,0) {%
				\begingroup
				\color{#1}\zihao{7}\songti #2 % ä½¿ç”¨7å·å­—(å°å­—)
				\endgroup
			};
		}{%
			% === ä¸‹æ–¹è¡Œé—´æ’å…¥ (é»˜è®¤ below) ===
			% anchor=north west: ä»åŸºçº¿å·¦ä¸‹è§’å‘ä¸‹ç”Ÿé•¿
			\node[anchor=north west, inner sep=0pt, align=left, text width=8cm, yshift=-0.2em+#4] 
			at (0,0) {%
				\begingroup
				\color{#1}\zihao{7}\songti #2 % ä½¿ç”¨7å·å­—(å°å­—)
				\endgroup
			};
		}%
	\end{tikzpicture}%
}

% --- 5. æ ¸å¿ƒå‘½ä»¤ \review ---
\NewDocumentCommand{\review}{ O{} m +m }{%
	% 1. è§£æå‚æ•°
	\pgfkeys{/hustreview, style=underline, color=red, side=right, offset=0pt, #1}%
	%
	% 2. æ­£æ–‡æ ‡è®°æ¸²æŸ“
	\begingroup
	\color{\hust@review@color}%
	\ifdefstring{\hust@review@style}{wave}{%
		\uwave{#2}%
	}{%
		\ifdefstring{\hust@review@style}{underline}{%
			\uline{#2}%
		}{%
			\ifdefstring{\hust@review@style}{strike}{%
				\sout{#2}%
			}{%
				\ifdefstring{\hust@review@style}{circle}{%
					\tcbox[enhanced, on line, arc=3pt, outer arc=3pt,
					colback=white, colframe=\hust@review@color,
					boxrule=0.8pt, left=2pt, right=2pt, top=0pt, bottom=0pt,
					boxsep=1pt, nobeforeafter, tcbox raise base]{#2}%
				}{%
					\ifdefstring{\hust@review@style}{highlight}{%
						\tcbox[on line, arc=0pt, outer arc=0pt,
						colback=\hust@review@color!20!white,
						colframe=\hust@review@color!20!white,
						boxrule=0pt, left=1pt, right=1pt, top=0pt, bottom=0pt,
						boxsep=0pt, nobeforeafter, tcbox raise base]{#2}%
					}{%
						\uline{#2}%
	}}}}}%
	\endgroup
	%
	% 3. æ‰¹æ³¨æ¸²æŸ“ (æ™ºèƒ½åˆ¤æ–­ä¾§è¾¹è¿˜æ˜¯è¡Œé—´)
	\if\relax\detokenize{#3}\relax
	\else
	% åˆ¤æ–­ side å‚æ•°æ˜¯å¦ä¸º below æˆ– above
	\ifdefstring{\hust@review@side}{below}{%
		\hust@drawinlinenote{\hust@review@color}{#3}{below}{\hust@review@offset}%
	}{%
		\ifdefstring{\hust@review@side}{above}{%
			\hust@drawinlinenote{\hust@review@color}{#3}{above}{\hust@review@offset}%
		}{%
			% é»˜è®¤ä¸ºä¾§è¾¹ (left/right)
			\hust@drawsidenote{\hust@review@color}{#3}{\hust@review@side}{\hust@review@offset}%
		}%
	}%
	\fi
}

% --- 6. åˆ«åå®šä¹‰ ---
\newcommand{\æ ‡æ³¨}{\review}
\newcommand{\selfreview}{\review}

% =========================================================
% 19. æ•™ç¨‹æ–‡æ¡£å±•ç¤ºç¯å¢ƒ (Tutorial Documentation Environments)
% =========================================================
% åŠŸèƒ½ï¼šç”¨äºç¼–å†™ LaTeX ç±»æ–‡ä»¶/å®åŒ…çš„ä½¿ç”¨æ–‡æ¡£
% æä¾›ä»£ç +æ•ˆæœå¹¶æ’å±•ç¤ºï¼ˆå·¦å³ã€ä¸Šä¸‹å¸ƒå±€ï¼‰
% =========================================================

% --- 19.1 ä¾èµ–ç¡®è®¤ (tcolorbox + listings å·²åœ¨å‰æ–‡åŠ è½½) ---

% --- 19.2 é…è‰²æ–¹æ¡ˆ ---
\definecolor{hust@demo@codebg}{RGB}{248,248,248}     % ä»£ç åŒºèƒŒæ™¯
\definecolor{hust@demo@resultbg}{RGB}{255,255,245}   % æ•ˆæœåŒºèƒŒæ™¯
\definecolor{hust@demo@frame}{RGB}{200,200,200}      % è¾¹æ¡†é¢œè‰²
\definecolor{hust@api@bg}{RGB}{240,248,255}          % API å¡ç‰‡èƒŒæ™¯
\definecolor{hust@api@frame}{RGB}{70,130,180}        % API å¡ç‰‡è¾¹æ¡†

% --- 19.3 ä»£ç å±•ç¤ºåŸºç¡€æ ·å¼ (ç”¨äºæ–‡æ¡£) ---
\lstdefinestyle{demostyle}{
    basicstyle=\small\ttfamily,
    keywordstyle=\bfseries\color{hust@keyword},
    commentstyle=\itshape\color{hust@comment},
    stringstyle=\color{hust@string},
    backgroundcolor=\color{hust@demo@codebg},
    frame=none,
    breaklines=true,
    showstringspaces=false,
    tabsize=2,
    columns=flexible,
    keepspaces=true,
    extendedchars=false,
    texcl=false,
    mathescape=false
}

% --- 19.4 democode ç¯å¢ƒï¼šå·¦å³åŒæ å±•ç¤º ---
% ç”¨æ³•ï¼š\begin{democode}{æ ‡é¢˜} LaTeXä»£ç  \end{democode}
% å·¦ä¾§æ˜¾ç¤ºæºä»£ç ï¼Œå³ä¾§æ˜¾ç¤ºç¼–è¯‘æ•ˆæœ
\newtcblisting{democode}[1]{
    enhanced,
    breakable,
    title={#1},
    fonttitle=\bfseries\heiti,
    coltitle=black,
    colbacktitle=gray!15,
    colframe=hust@demo@frame,
    boxrule=0.8pt,
    arc=3pt,
    listing engine=listings,
    listing options={style=demostyle},
    sidebyside,
    sidebyside align=top,
    lefthand ratio=0.5,
    righthand width=0.46\linewidth,
    colback=hust@demo@codebg,
    segmentation style={solid, hust@demo@frame},
    % å³ä¾§æ•ˆæœåŒºæ ·å¼
    bicolor,
    colbacklower=hust@demo@resultbg,
    % é—´è·
    left=3pt, right=3pt, top=2pt, bottom=2pt,
    middle=3pt
}

% --- 19.5 demovert ç¯å¢ƒï¼šä¸Šä¸‹å¸ƒå±€å±•ç¤º ---
% ç”¨æ³•ï¼š\begin{demovert}{æ ‡é¢˜} LaTeXä»£ç  \end{demovert}
% ä¸Šæ–¹æ˜¾ç¤ºæºä»£ç ï¼Œä¸‹æ–¹æ˜¾ç¤ºç¼–è¯‘æ•ˆæœ
\newtcblisting{demovert}[1]{
    enhanced,
    breakable,
    title={#1},
    fonttitle=\bfseries\heiti,
    coltitle=black,
    colbacktitle=gray!15,
    colframe=hust@demo@frame,
    boxrule=0.8pt,
    arc=3pt,
    listing engine=listings,
    listing options={style=demostyle},
    listing and text,
    colback=hust@demo@codebg,
    segmentation style={solid, hust@demo@frame},
    % ä¸‹æ–¹æ•ˆæœåŒºæ ·å¼
    bicolor,
    colbacklower=hust@demo@resultbg,
    % é—´è·
    left=5pt, right=5pt, top=3pt, bottom=3pt,
    middle=3pt
}

% --- 19.6 codeonly ç¯å¢ƒï¼šä»…å±•ç¤ºä»£ç  ---
% ç”¨æ³•ï¼š\begin{codeonly}{æ ‡é¢˜} LaTeXä»£ç  \end{codeonly}
\newtcblisting{codeonly}[1]{
    enhanced,
    breakable,
    title={#1},
    fonttitle=\bfseries\heiti,
    coltitle=black,
    colbacktitle=gray!15,
    colframe=hust@demo@frame,
    colback=hust@demo@codebg,
    boxrule=0.8pt,
    arc=3pt,
    listing engine=listings,
    listing options={style=demostyle},
    listing only,
    left=5pt, right=5pt, top=3pt, bottom=3pt
}

% --- 19.7 apibox å‘½ä»¤ï¼šAPI å‚è€ƒå¡ç‰‡ ---
% ç”¨æ³•ï¼š\apibox{å‘½ä»¤å}{å‚æ•°è¯´æ˜}{åŠŸèƒ½æè¿°}
\newcommand{\apibox}[3]{%
    \begin{tcolorbox}[
        enhanced,
        colback=hust@api@bg,
        colframe=hust@api@frame,
        boxrule=1pt,
        arc=4pt,
        left=8pt, right=8pt, top=6pt, bottom=6pt,
        fonttitle=\bfseries\ttfamily,
        title={\textbackslash #1},
        coltitle=white,
        colbacktitle=hust@api@frame,
        attach boxed title to top left={xshift=5mm, yshift=-3mm},
        boxed title style={arc=2pt, boxrule=0pt}
    ]
    \textbf{å‚æ•°ï¼š} \texttt{#2} \\[3pt]
    \textbf{è¯´æ˜ï¼š} #3
    \end{tcolorbox}
}

% --- 19.8 optionlist ç¯å¢ƒï¼šé€‰é¡¹åˆ—è¡¨ ---
% ä½¿ç”¨ç®€å•çš„ tabular å®ç°ï¼Œå®Œå…¨é¿å… xeCJK å…¼å®¹æ€§é—®é¢˜
\newenvironment{optionlist}{%
    \par\vspace{0.5em}%
    \noindent%
}{%
    \par\vspace{0.5em}%
}

% \option å‘½ä»¤ï¼šé€‰é¡¹æ¡ç›®
\newcommand{\option}[2]{%
    \noindent\hspace{1em}%
    \texttt{\bfseries\color{hust@api@frame}#1}%
    \hspace{0.5em}---\hspace{0.5em}#2%
    \par\vspace{0.3em}%
}

% --- 19.9 inlinecode å‘½ä»¤ï¼šè¡Œå†…ä»£ç é«˜äº® ---
\newcommand{\cmd}[1]{\texttt{\textbackslash #1}}
\newcommand{\env}[1]{\texttt{#1}}
\newcommand{\opt}[1]{\texttt{[#1]}}

\makeatother
% =========================================================
% End of Class File
% =========================================================